/**
 * ScrollWatch 1.3 / jQuery plugin
 * @author ShiraNai7
 */
void function(c){function b(f,e){if(window===e||undefined===e){e=null}var g=0;do{g+=f.offsetTop}while((f=f.offsetParent)&&f!==e);return g}function a(e){var f=0;do{f+=e.offsetTop}while((e=e.offsetParent));return f}function d(g,f,h,e){if(h>f||e<g){return null}return[g>h?g:h,f>e?e:f]}c.fn.scrollWatch=function(s){s=c.extend({},c.fn.scrollWatch.defaults,s);if(typeof s.callback!=="function"){throw new Error('The "callback" option is required and must be a function')}var g=this,o,l=c(s.scroller),p=(window===s.scroller),r,h,k=null,n=false;if(0===g.length){throw new Error("No sections found")}var j;function q(){o=[];g.each(function(){var t=b(this,s.scroller);j=t+this.offsetHeight;o.push([t,j,j-t])});o.sort(function(u,t){return u[0]-t[0]})}function i(){if(p){r=c(window).height();h=window.scrollHeight}else{r=s.scroller.clientHeight;h=s.scroller.scrollHeight}}function m(){if(n){return}var y=l.scrollTop(),A=y+r;if(0!==s.viewMarginTop){y+=s.viewMarginTop}if(0!==s.viewMarginBottom){A=Math.max(y+1,A-s.viewMarginBottom)}var v=[],x,u;if(h-A<5){var D=o.length-1;x=d(y,A,o[D][0],o[D][1]);v.push({index:D,focusIntersection:x,focusHeight:(null===x)?null:(x[1]-x[0]),elem:g[D],isFull:u>=o[D][2],asClosest:false})}else{if(y-s.viewMarginTop<5){x=d(y,A,o[0][0],o[0][1]);v.push({index:0,focusIntersection:x,focusHeight:(null===x)?null:(x[1]-x[0]),elem:g[0],isFull:u>=o[0][2],asClosest:false})}else{for(var B=0;B<o.length;++B){x=d(y,A,o[B][0],o[B][1]);if(null!==x){v.push({index:B,focusIntersection:x,focusHeight:x[1]-x[0],elem:g[B],isFull:u>=o[B][2],asClosest:false})}}if(0===v.length){var t=null,C;for(B=0;B<o.length;++B){C=Math.abs(o[B][0]-y);if(null===t||t[1]>C){t=[B,C]}}v.push({index:t[0],focusIntersection:null,focusHeight:null,elem:g[t[0]],isFull:false,asClosest:true})}}}if(!s.multiMode){if(1===v.length){s.callback(v[0],y,A)}else{var w=null;switch(s.resolutionMode){case 0:v.sort(function(F,E){if(F.index<E.index){return E.focusHeight-F.focusHeight-s.topDownWeight}return E.focusHeight-F.focusHeight});w=v[0];break;case 1:var z=y+(A-y)*s.focusRatio+s.focusOffset;if(s.debugFocusLine){if(null===k){f()}k.style.top=Math.round(z)+"px"}for(B=0;B<v.length;++B){if(v[B].focusIntersection[0]<=z&&v[B].focusIntersection[1]>=z){w=v[B];break}}if(null===w){for(B=0;B<v.length;++B){v[B].focusRatioOffsetDistance=Math.min(Math.abs(v[B].focusIntersection[0]-z),Math.abs(v[B].focusIntersection[1]-z))}v.sort(function(F,E){return F.focusRatioOffsetDistance-E.focusRatioOffsetDistance});w=v[0]}break;default:throw new Error("Invalid resolution mode")}s.callback(w,y,A)}}else{s.callback(v,y,A)}}function e(){q();i();m()}function f(){k=document.createElement("div");k.style.width="10%";k.style.height="0";k.style.position="absolute";k.style.left="0";k.style.top="0";k.style.borderTop="1px solid yellow";k.style.borderBottom="1px solid red";k.style.borderRight="3px solid black";k.style.zIndex="9999";k=c(k).appendTo(p?document.body:l)[0]}e();l.scroll(m);if(p){l.resize(e)}return{unbind:function(){l.unbind("scroll",m);if(p){l.unbind("resize",e)}},update:function(){e()},updateFocus:function(){m()},pause:function(){n=true},resume:function(){n=false;m()},setOption:function(t,u){s[t]=u;return this}}};c.fn.scrollWatchMenu=function(m,o){var l=window,h=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)||/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor),j,g=null,e=c(h?document.body:"html"),k,n;o=c.extend({},c.fn.scrollWatchMenu.defaults,o,{callback:function(p){if(p.index<j.length&&p.index!==g){if(null!==g){c(j[g]).removeClass(o.menuActiveClass)}c(j[p.index]).addClass(o.menuActiveClass);g=p.index}}});function f(p,q){e.scrollTop(p);if(null!==q){k.scrollTop(q)}}function i(p,q){if(e.is(":animated")){e.stop(true,true)}e.animate({scrollTop:p+o.menuWindowScrollOffset},o.menuScrollSpeed);if(null!==q){if(k.is(":animated")){k.stop(true,true)}k.animate({scrollTop:q+o.menuScrollerScrollOffset},o.menuScrollerScrollSpeed||o.menuScrollSpeed)}}k=c(o.scroller);if(k.length<1){throw new Error("Could not find the scroller element")}if(l===k.get(0)){k=null}j=c(this)[("*"===o.menuItemSelector)?"children":"find"](o.menuItemSelector);if(o.menuHandleHashLinks){if(0!==o.menuScrollOffset&&l.location.hash){c("a",j).each(function(){if(this.hash===l.location.hash){var s=this.hash.substr(1),r=c("#"+s+", [name="+s+"]");if(r.length>0){r=r.get(0);var p=a(r),q=(k?b(r,k.get(0)):null);setTimeout(function(){if(Math.abs(p-e.scrollTop())<o.menuInitialHashOffsetTolerance){f(p,q)}},100);return false}}return true})}if(0!==o.menuScrollOffset||o.menuScrollSpeed>0){c("a",j).click(function(){if(""===this.hash){return true}var u=this.hash.substr(1),t=c("#"+u+", [name="+u+"]"),s=e.scrollTop(),r=(k?k.scrollTop():null),p,q;if(t.length>0){t=t.get(0);p=a(t);q=(k?b(t,k.get(0)):null)}else{return true}n.pause();l.location.hash=u;e.scrollTop(s);if(k){k.scrollTop(r)}n.resume();if(o.menuScrollSpeed>0){i(p,q)}else{f(p,q)}return false})}}n=c(m).scrollWatch(o);c.extend(n,{setMenuOption:function(p,q){o[p]=q;return this},instantScroll:function(p,q){f(p,(null!==k)?q:null)},animatedScroll:function(p,q){i(p,(null!==k)?q:null)}});return n};c.fn.scrollWatch.defaults={callback:null,scroller:window,multiMode:false,resolutionMode:0,topDownWeight:0,viewMarginTop:0,viewMarginBottom:0,focusRatio:0.38196601125010515,focusOffset:0,debugFocusLine:false};c.fn.scrollWatchMenu.defaults={scroller:window,menuActiveClass:"active",menuItemSelector:"*",menuWindowScrollOffset:0,menuScrollerScrollOffset:0,menuScrollSpeed:500,menuScrollerScrollSpeed:null,menuInitialHashOffsetTolerance:40,menuHandleHashLinks:true}}(jQuery);